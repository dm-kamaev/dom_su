<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/jquery.mobile-1.4.5/jquery.mobile-1.4.5.min.css">
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
    <script src="/static/jquery.mobile-1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script src="/static/js/custom_cookie.js?v=1.0"></script>
    <!-- Google Tag Manager -->
{{#if general.production}}

  <noscript>
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-PHD7WW" height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript>

  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PHD7WW');</script>

{{/if}}
    <!-- End Google Tag Manager -->
</head>
<body class="">
    <div data-role="page" class="jqm-demos ui-responsive-panel" id="main-page" data-title="Личный кабинет от Домовёнка">
        <div data-role="header" data-position="fixed" data-tap-toggle="false">
            <h1 style="overflow: visible">Обращения</h1>
            <a href="#nav-panel" data-icon="bars" data-iconpos="notext">Menu</a>
        </div>
        <div role="main" class="ui-content jqm-content jqm-fullwidth">
        <script>$(document).unbind('scroll');</script>
        <div data-role="collapsible" data-content-theme="false">
        <h4>Создать обращение</h4>
        <form action="" method="POST" enctype="multipart/form-data" data-ajax="false" >
            <label>Название:<input name="subject" style="" type="text" required></label>
            <label>Сообщение:<textarea name="content" required style="" type="text"></textarea></label>
            <button type="submit">Создать</button>
        </form>
        </div>
        {{#each conversationList as |conversation|}}
            <a class="ui-btn" href="{{staffUrl 'conversationDetail' ../employeeId conversation.ConversationID }}">
              <div class="ui-block-a">
                  <div class="ui-body ui-body-d">{{formatPartDate conversation.Date "DD.MM.YYYY"}}</div>
              </div>
              <div class="ui-block-d">
                  <div class="ui-body ui-body-d">
                      <div class="ui-block-c">
                              <span style="font-weight: normal; color: {{#ifCond conversation.Status '==' 'Активно'}}green{{else}}red{{/ifCond}}">{{conversation.Status}}</span>
                      </div>
                  </div>
              </div>
              <div class="ui-block-b"><div class="ui-body ui-body-d"><span style="font-weight: normal; white-space: normal">{{conversation.Subject}}</span></div></div>
            </a>
            {{#conversation.renderSelectScore}}
              <div id=block_score_{{conversation.indexId}} data-role="content">
                <fieldset id=select_score_{{conversation.indexId}} data-role="controlgroup" data-type="horizontal">
                  <legend>Оценить:</legend>
                  <input type=radio name="radio-choice-h-2" id=score_1_{{conversation.indexId}} value=1>
                  <label for=score_1_{{conversation.indexId}}>1</label>
                  <input type=radio name="radio-choice-h-2" id=score_2_{{conversation.indexId}} value=2>
                  <label for=score_2_{{conversation.indexId}}>2</label>
                  <input type=radio name="radio-choice-h-2" id=score_3_{{conversation.indexId}} value=3>
                  <label for=score_3_{{conversation.indexId}}>3</label>
                  <input type=radio name="radio-choice-h-2" id=score_4_{{conversation.indexId}} value=4>
                  <label for=score_4_{{conversation.indexId}}>4</label>
                  <input type=radio name="radio-choice-h-2" id=score_5_{{conversation.indexId}} value=5>
                  <label for=score_5_{{conversation.indexId}}>5</label>
                </fieldset>
                <div id=show_score_{{conversation.indexId}}></div>
              </div>
            {{/conversation.renderSelectScore}}
            {{#conversation.Score}}
              <div style=margin-top:15px;>
                <span style=margin-left:10px;font-size:110%>Оценка: {{conversation.Score}}</span>
              </div>
            {{/conversation.Score}}
        {{/each}}

         <div data-demo-html="#panel-responsive-page1"></div>
        </div>
            <div data-role="panel" data-display="overlay" data-theme="b" id="nav-panel">
                <ul data-role="listview">
                    <li data-icon="delete"><a href="#" data-rel="close">Закрыть Меню</a></li>
                        <li><a data-ajax="false" href="{{staffUrl 'employeeDetail' selfId }}?profile=true" {{#if activeProfile }} class="ui-btn ui-btn-active" {{/if}}>Профиль</a></li>
                        <li><a href="{{staffUrl 'creditsCurrent' selfId }}" {{#if activeCredits }} class="ui-btn ui-btn-active" {{/if }}>Заработано</a></li>
                        <li><a href="{{staffUrl 'depositCurrent' selfId }}" {{#if activeDebits }} class="ui-btn ui-btn-active" {{/if }}>Необходимо сдать</a></li>
                        <li><a href="{{staffUrl 'employeeDetail' selfId }}?orders=true" {{#if activeOrders }} class="ui-btn ui-btn-active" {{/if }}>Заказы</a></li>
                        <li><a data-ajax="false" href="{{staffUrl 'rating' selfId }}" {{#if activeRating }} class="ui-btn ui-btn-active" {{/if }}>Рейтинг</a></li>
                        <li><a href="{{staffUrl 'disciplinaryList' selfId }}" {{#if activeDisciplinary }} class="ui-btn ui-btn-active" {{/if }}>Нарушения</a></li>
                        <li><a href="{{staffUrl 'conversationList' selfId }}" class="ui-btn ui-btn-active" >Обращения</a></li>
                        <li><a href="{{staffUrl 'news' selfId}}" {{#if activeNews }} class="ui-btn ui-btn-active" {{/if }}>Новости</a></li>
                        <li><a data-ajax=false href="{{staffUrl 'means_and_materials' selfId}}">Средства и материалы</a></li>
                        <li><a data-ajax=false href="{{staffUrl 'description_services' selfId}}" class='ui-btn'>Услуги</a></li>
                        <li><a data-ajax="false" onclick="mobile_view(false)" href="">Полная версия</a></li>
                        <li><a data-ajax="false" href="{{staffUrl 'logout' }}">Выйти</a></li>
                </ul>
            </div>
    </div>
<script>
  {{#each conversationList as |conversation|}}
    mountEvents('{{conversation.indexId}}', '{{conversation.ConversationID}}');
  {{/each}}

  function mountEvents(indexId, conversationId) {
    $("#select_score_"+indexId).on('change', function() {
      var score = $("input[name='radio-choice-h-2']:checked").val();
      $('#select_score_'+indexId).hide();
      $('#show_score_'+indexId).html('<span style=margin-left:10px;font-size:110%>Оценка: '+score+'</span>').show();
      $.post('/staff/ajax/conversations/'+conversationId+'/score/'+score, {}, function(result, textStatus, jqXHR) { });
    });
  }
</script>
</body>
</html>